<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./reset.css">
    <link rel="stylesheet" href="./style.css">
    <title>Blendo - Color Blender</title>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">Blendo</div>
        </header>
        <main class="row">
            <div class="col col-info">
                <div class="section_title">Random Color Swatches</div>
                <div id="color-swatch-container"></div>
            </div>
            <div class="col col-controls">
                <div class="section_title">Select Color Range</div>
                <input id="color1" maxlength="7" value="" placeholder="Hex Color 1">
                <input id="color2" maxlength="7" value="" placeholder="Hex Color 2">
                <div class="controls-row">
                    <select id="numberOfBlends">
                        <option selected>Blends</option>
                        <option id="1">1</option>
                        <option id="2">2</option>
                        <option id="3">3</option>
                        <option id="4">4</option>
                        <option id="5">5</option>
                        <option id="6">6</option>
                        <option id="7">7</option>
                        <option id="8">8</option>
                        <option id="9">9</option>
                        <option id="10">10</option>
                    </select>
                    <button id="btnReset">Reset</button>
                </div>
                <p>
                    <div class="section_title">Some general usage ...</div>
                    <ol>
                        <li>Put any hex color in color 1</li>
                        <li>Select another hex you want to blend in color 2</li>
                        <li>Choose how many blends you want</li>
                        <li>WIN!</li>
                    </ol>
                    If you need inspiration for colors, random swatches are generated on the left in the waterfall.
                </p>
            </div>
            <div id="swatches" class="col col-swatches">
            </div>
        </main>
        <footer>
            <a href="https://www.buymeacoffee.com/sfritsen" target="_blank">Buy me a coffee!</a>
            <a href="https://github.com/sfritsen/blendo">Blendo on Github</a>
        </footer>
    </div>
</body>
</html>

<script type="text/javascript">

    window.addEventListener("load", function() {
        generateColorGrid();
    });

    function generateColorGrid() {

        const grid = document.createElement('div');
        grid.style.display = 'flex';
        grid.style.flexWrap = 'wrap';

        for (let i = 0; i < 50; i++) {
            const swatch = document.createElement('div');
            let swatchColor = getRandomHexColor();
            swatch.classList.add('color-swatch');
            swatch.style.backgroundColor = swatchColor;
            swatch.id = "hex" + swatchColor;
            swatch.innerHTML = isLightColor(swatchColor);
            grid.appendChild(swatch);
        }

        let waterfallContainer = document.getElementById("color-swatch-container");
        waterfallContainer.appendChild(grid);
    }

    function getRandomHexColor() {
        const letters = '0123456789ABCDEF';
        let color = '#';
        for (let i = 0; i < 6; i++) {
            color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
    }

    document.getElementById("btnReset").addEventListener("click", (e) => {
        document.getElementById("color1").value = "";
        document.getElementById("color2").value = "";
        document.getElementById("numberOfBlends").selectedIndex = 0;
        swatches.innerHTML = '';
    });

    document.getElementById("color1").addEventListener("keyup", (e) => {
        let color1 = document.getElementById("color1");
        color1.value = validateInput(color1);
        processHex();
    });

    document.getElementById("color2").addEventListener("keyup", (e) => {
        let color2 = document.getElementById("color2");
        color2.value = validateInput(color2);
        processHex();
    });

    document.getElementById("numberOfBlends").addEventListener("change", (e) => {
        processHex();
    });

    function validateInput(inputtxt) {
        // Allowed characters
        const validCharacters = /^[a-fA-F0-9#]+$/;

        // Check supplied input
        if (validCharacters.test(inputtxt.value)) {
            return inputtxt.value = inputtxt.value.replace(/\s/g, "");
        } else {
            return "";
        }
    }

    function processHex() {
        // Get color1 and color2 and swatches container
        let color1 = document.getElementById("color1").value;
        let color2 = document.getElementById("color2").value;
        let numberOfBlends = document.getElementById("numberOfBlends");
        let swatches = document.getElementById("swatches");

        color1 = hexColorValidation(color1);
        color2 = hexColorValidation(color2);

        // Clear swatches
        swatches.innerHTML = '';

        // Call midpoints function and pass the 2 colors
        let midpointColors = findMidpointColors(color1, color2, numberOfBlends.value);

        // Create fragment to append after foreach
        let toAdd = document.createDocumentFragment();

        // console.log(numberOfBlends.value);
        const totalDivs = Number(numberOfBlends.value) + 2;

        // Loop through returned array, calculate height and build divs for each
        midpointColors.forEach((value) => {

            // Calculate height percentage for every needed new div
            const divPercentage = Math.round((100 / Number(totalDivs)) * 100) / 100;

            // Create divs
            var newDiv = document.createElement('div');
            newDiv.id = 'div'+value;
            newDiv.innerHTML = isLightColor(value);
            newDiv.style.backgroundColor = value;
            newDiv.style.height = divPercentage+'%';
            toAdd.appendChild(newDiv);
        });

        // Add to swatches section
        swatches.appendChild(toAdd);
    }

    // Validate and clean inputted colors
    function hexColorValidation(hexColor) {

        // Get the first character of hexColor
        const hashtag = hexColor.charAt(0);

        if (hashtag === "#") {
            hexColor = hexColor.substring(1);
        }

        switch (hexColor.length) {
            case 1:
            case 2:
            case 4:
            case 5:
            case 7:
                // Invalid input
                console.log("INVALID HEX 1");
                swatches.innerHTML = '';
                break;
            case 3:
                // Split the hex color into separate characters
                const [r, g, b] = hexColor.split('');

                // Convert each character to a 2 digit string and concatenate them
                const newHexColor = `${r}${r}${g}${g}${b}${b}`;

                // Return the new 6 digit hex color with hashtag
                hexColor = newHexColor;
                break;
            default:
                // Invalid input
                console.log("INVALID HEX 2");
                swatches.innerHTML = '';
                break;
        }

        return hexColor = "#" + hexColor;
    }

    function findMidpointColors(color1, color2, numberOfBlends) {
        let steps = Number(numberOfBlends) + 1; // number of steps to blend
        let stepSize = 1 / steps; // size of each step

        // Convert the hex color strings to RGB values
        let rgb1 = hexToRgb(color1);
        let rgb2 = hexToRgb(color2);

        // Calculate the step size for each color component
        let rStep = (rgb2.r - rgb1.r) * stepSize;
        let gStep = (rgb2.g - rgb1.g) * stepSize;
        let bStep = (rgb2.b - rgb1.b) * stepSize;

        // Create an array to store the midpoint colors
        let colors = [];

        // Loop through the steps and find the midpoint colors
        for (var i = 0; i <= steps; i++) {
            let r = Math.round(rgb1.r + rStep * i);
            let g = Math.round(rgb1.g + gStep * i);
            let b = Math.round(rgb1.b + bStep * i);
            colors.push(rgbToHex(r, g, b));
        }

        // Return the array of midpoint colors
        return colors;
    }

    // Helper function to convert hex color strings to RGB values
    function hexToRgb(hex) {
        let r = parseInt(hex.slice(1, 3), 16);
        let g = parseInt(hex.slice(3, 5), 16);
        let b = parseInt(hex.slice(5, 7), 16);
        return { r: r, g: g, b: b };
    }

    // Helper function to convert RGB values to hex color strings
    function rgbToHex(r, g, b) {
        let hex = "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        return hex;
    }

    // Helper to determine light vs dark color for overlay text
    function isLightColor(hexColor) {
        // Convert hex color to RGB
        const red = parseInt(hexColor.substring(1, 3), 16);
        const green = parseInt(hexColor.substring(3, 5), 16);
        const blue = parseInt(hexColor.substring(5, 7), 16);

        // Calculate relative luminance using sRGB color space formula
        const relativeLuminance = 0.2126 * red + 0.7152 * green + 0.0722 * blue;

        // Compare relative luminance to threshold value
        if (relativeLuminance > 128) {
            // Light color
            return `<span style="color: #333">${hexColor}</span>`;
        } else {
            // Dark color
            return `<span style="color: #e8e8e8">${hexColor}</span>`;
        }
    }
</script>