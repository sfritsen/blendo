<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./reset.css">
    <link rel="stylesheet" href="./style.css">
    <title>Blendo - Color Picker</title>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">Blendo</div>
        </header>
        <main class="row">
            <div class="col col-info">
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam egestas quam ut dui posuere, at vulputate justo consequat. Ut maximus vestibulum mattis. Praesent ut fermentum sapien. Phasellus eu ligula nisl. Nam vitae hendrerit nibh. Suspendisse consectetur libero in sem fermentum, vel vulputate risus facilisis. Nam sed semper justo, eget aliquam mauris. Ut in pretium ligula, eget consectetur elit. Cras vitae enim sit amet justo posuere cursus. Mauris dictum urna non tellus viverra, sed maximus elit ultrices.</p>
                <p>Proin rhoncus nulla nec arcu auctor, ut convallis elit bibendum. Cras venenatis maximus massa, eu mattis nunc pharetra ut. In vel mattis odio. Phasellus eu eleifend arcu. Mauris viverra ex id tellus posuere condimentum. Donec mi mi, aliquet ut ex cursus, porta commodo leo. Proin et fermentum augue, non maximus diam. Proin laoreet consequat tempor. Ut ut arcu auctor, auctor odio ac, euismod lectus. Morbi facilisis nisi eu arcu convallis, sed egestas orci varius. Integer eu lectus at risus imperdiet tempus. Nulla dictum volutpat nulla, sit amet posuere enim pellentesque eget.</p>
                <p>Donec egestas magna at est venenatis, a ultrices libero lobortis. Phasellus ac luctus ipsum. Aenean interdum semper suscipit. Fusce sed rhoncus dolor, vel porta erat. Etiam eu mauris odio. Etiam eget justo non massa pellentesque finibus sed eget metus. Suspendisse volutpat odio nec sapien volutpat, in pretium lectus posuere. </p>
            </div>
            <div class="col col-controls">
                <div class="section_title">Select Color Range</div>
                <input id="color1" maxlength="7" placeholder="#Color 1">
                <input id="color2" maxlength="7" placeholder="#Color 2">
                <select id="numberOfBlends">
                    <option selected>Number of Blends</option>
                    <option id="1">1</option>
                    <option id="2">2</option>
                    <option id="3">3</option>
                    <option id="4">4</option>
                    <option id="5">5</option>
                    <option id="6">6</option>
                    <option id="7">7</option>
                    <option id="8">8</option>
                    <option id="9">9</option>
                    <option id="10">10</option>
                </select>
            </div>
            <div id="swatches" class="col col-swatches">
            </div>
        </main>
        <footer>Buy Marc a coffee</footer>
    </div>
</body>
</html>

<script type="text/javascript">
    document.getElementById("color1").addEventListener("keyup", (e) => {
        let color1 = document.getElementById("color1");
        color1.value = validateInput(color1);
    });

    document.getElementById("color2").addEventListener("keyup", (e) => {
        let color2 = document.getElementById("color2");
        color2.value = validateInput(color2);
    });

    function validateInput(inputtxt) {
        // Allowed characters
        const validCharacters = /^[a-fA-F0-9#]+$/;

        // Reset blends select
        document.getElementById("numberOfBlends").selectedIndex = 0;

        // Check supplied input
        if (validCharacters.test(inputtxt.value)) {
            return inputtxt.value = inputtxt.value.replace(/\s/g, "");
        } else {
            return "";
        }
    }

    document.getElementById("numberOfBlends").addEventListener('change', (e) => {

        // Get color1 and color2 and swatches container
        let color1 = document.getElementById("color1").value;
        let color2 = document.getElementById("color2").value;
        let numberOfBlends = document.getElementById("numberOfBlends");
        let swatches = document.getElementById("swatches");

        color1 = hexColorValidation(color1);
        color2 = hexColorValidation(color2);

        // Clear swatches
        swatches.innerHTML = '';

        // Call midpoints function and pass the 2 colors
        var midpointColors = findMidpointColors(color1, color2, numberOfBlends.value);

        // Create fragment to append after foreach
        var toAdd = document.createDocumentFragment();

        // console.log(numberOfBlends.value);
        let totalDivs = Number(numberOfBlends.value) + 2;

        // Loop through returned array and build divs for each
        midpointColors.forEach((value) => {

            // Calculate height percentage for every needed new div
            const divPercentage = Math.round((100 / Number(totalDivs)) * 100) / 100;

            // Create divs
            var newDiv = document.createElement('div');
            newDiv.id = 'div'+value;
            newDiv.innerHTML = isLightColor(value);
            newDiv.style.backgroundColor = value;
            newDiv.style.height = divPercentage+'%';
            toAdd.appendChild(newDiv);
        });

        // Add to swatches section
        swatches.appendChild(toAdd);

        // Validate and clean inputted colors
        function hexColorValidation(hexColor) {

            // Get the first character of hexColor
            const hashtag = hexColor.charAt(0);

            if (hashtag === "#") {
                hexColor = hexColor.substring(1);
            }

            switch (hexColor.length) {
                case 1:
                case 2:
                case 4:
                case 5:
                case 7:
                    // Invalid input
                    console.log("INVALID HEX");
                    break;
                case 3:
                    // Split the hex color into separate characters
                    const [r, g, b] = hexColor.split('');

                    // Convert each character to a 2 digit string and concatenate them
                    const newHexColor = `${r}${r}${g}${g}${b}${b}`;

                    // Return the new 6 digit hex color with hashtag
                    hexColor = newHexColor;
                    break;
                default:
                    // Invalid input
                    console.log("INVALID HEX");
                    break;
            }

            return hexColor = "#" + hexColor;
        }

        function findMidpointColors(color1, color2, numberOfBlends) {
            var steps = Number(numberOfBlends) + 1; // number of steps to blend
            var stepSize = 1 / steps; // size of each step

            // Convert the hex color strings to RGB values
            var rgb1 = hexToRgb(color1);
            var rgb2 = hexToRgb(color2);

            // Calculate the step size for each color component
            var rStep = (rgb2.r - rgb1.r) * stepSize;
            var gStep = (rgb2.g - rgb1.g) * stepSize;
            var bStep = (rgb2.b - rgb1.b) * stepSize;

            // Create an array to store the midpoint colors
            var colors = [];

            // Loop through the steps and find the midpoint colors
            for (var i = 0; i <= steps; i++) {
                var r = Math.round(rgb1.r + rStep * i);
                var g = Math.round(rgb1.g + gStep * i);
                var b = Math.round(rgb1.b + bStep * i);
                colors.push(rgbToHex(r, g, b));
            }

            // Return the array of midpoint colors
            return colors;
        }

        // Helper function to convert hex color strings to RGB values
        function hexToRgb(hex) {
            var r = parseInt(hex.slice(1, 3), 16);
            var g = parseInt(hex.slice(3, 5), 16);
            var b = parseInt(hex.slice(5, 7), 16);
            return { r: r, g: g, b: b };
        }

        // Helper function to convert RGB values to hex color strings
        function rgbToHex(r, g, b) {
            var hex = "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
            return hex;
        }

        // Helper to determine light vs dark color for overlay text
        function isLightColor(hexColor) {
            // Convert hex color to RGB
            const red = parseInt(hexColor.substring(1, 3), 16);
            const green = parseInt(hexColor.substring(3, 5), 16);
            const blue = parseInt(hexColor.substring(5, 7), 16);

            // Calculate relative luminance using sRGB color space formula
            const relativeLuminance = 0.2126 * red + 0.7152 * green + 0.0722 * blue;

            // Compare relative luminance to threshold value
            if (relativeLuminance > 128) {
                // Light color
                return `<span style="color: #000000">${hexColor}</span>`;
            } else {
                // Dark color
                return `<span style="color: #FFFFFF">${hexColor}</span>`;
            }
        }

    });
    
</script>